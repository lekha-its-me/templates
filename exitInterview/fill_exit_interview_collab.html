<div class="fillForm">
	<div class="notification"></div>
	<form>
		<div class="form-group">
			<label for="question_1">Сколько лет Вы проработали в компании?</label>
			<select class="form-control" id="question_1">
				<option>До 1 года</option>
				<option>От 1 года до 3 лет</option>
				<option>Больше 5 лет</option>
				<option>Больше 10 лет</option>
			</select>
		</div>
		<div id="question_2">
			<label>Что Вам нравилось в занимаемой должности? (выберите не более 3-х вариантов)</label>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>Возможность применения своих профессиональных навыков</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>Постоянное профессиональное развитие</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>Амбициозные задачи и проекты</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>Коммуникация с коллегами / клиентами</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>Финансовая мотивация</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2">
			    <p>График работы</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_2" data-status="0" name="self">
			    <p>Свой вариант</p>
			  </label>
			</div>
			<input type="text" class="form-control self_question" id="self_question_2" placeholder="Напишите свой вариант">
			<!-- Добавить возможность своего варианта -->
		</div>
		<div id="question_3">
			<label>Как вы оцениваете организацию рабочего места?</label>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Плохое оборудование рабочего места</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Устаревшее оборудование</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Устаревшая мебель и дизайн помещения</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Несвоевременное подключение к электронным системам Компании (согласно функционала)</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Плохое состояние здания</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Плохие бытовые помещения и их санитарное состояние</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Некачественная форма и / или несвоевременно выдана</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3">
			    <p>Тяжелые условия труда (шум, грязь, темно, жарко, и т.д.)</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_3" data-status="0" name="self">
			    <p>Свой вариант</p>
			  </label>
			</div>
			<input type="text" class="form-control self_question" id="self_question_3" placeholder="Напишите свой вариант">
			<!-- Добавить возможность своего варианта -->
		</div>
		<div id="question_4">
			<label>Укажите, пожалуйста, истинные причины Вашего увольнения (выберите не более 3-ч вариантов)?</label>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Желание сменить сферу деятельности</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Неудовлетворительный уровень заработной платы</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Лучшее предложение по работе</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Чрезмерная загруженность</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Отсутствие условий для профессионального роста</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Конфликт с руководством</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Смена места жительства</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>По состоянию здоровья</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>По семейным обстоятельствам</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Невозможность в полной мере реализовать свои знания, опыт и навыки</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4">
			    <p>Сокращение</p>
			  </label>
			</div>
			<div class="checkbox">
			  <label>
			    <input type="checkbox" class="question_4" data-status="0" name="self">
			    <p>Свой вариант</p>
			  </label>
			</div>
			<input type="text" class="form-control self_question" id="self_question_4" placeholder="Напишите свой вариант">
			<!-- Добавить возможность своего варианта -->
		</div>
		<div class="form-group">
			<label for="question_5">Какая обстановка существует внутри Вашего подразделения (департамента / отдела / магазина)?</label>
			<select class="form-control" id="question_5">
				<option>Здоровая и дружественная, проводим вместе рабочее и личное время</option>
				<option>Рабочая и конструктивная, обсуждаем рабочие вопросы и рабочее время</option>
				<option>Не общаемся, рабочие вопросы решаем по электронной почте</option>
				<option>Неблагоприятная, все коллеги находятся в состоянии постоянного стресса</option>
			</select>
		</div>
		<div class="form-group">
			<label for="question_6">Какие взаимоотношения у Вас складывались с коллегами?</label>
			<select class="form-control" id="question_6">
				<option>Отличные - планируем и дальше продолжать общение вне работы</option>
				<option>Нормальные - общались исключительно по рабочим вопросам</option>
				<option>Негативные - не поддерживали никаких взаимоотношений</option>
			</select>
		</div>
		<div class="form-group">
			<label for="question_7">Какие взаимоотношения у Вас складывались с руководителем?</label>
			<select class="form-control" id="question_7">
				<option>Отличные - руководитель оказывал помощь в рабочих вопросах, не возникало конфликтных ситуация</option>
				<option>Нормальные - руководитель оказывал помощь в рабочих вопросах, периодически возникали спорные ситуации</option>
				<option>Нейтральные - общались только при наличии рабочих вопросов</option>
				<option>Негативные - не получалось найти общий язык</option>
			</select>
		</div>
		<div class="form-group">
			<label for="question_8">Какие условия были предоставлены Вам для повышения квалификации?</label>
			<select class="form-control" id="question_8">
				<option>Посещение внутренних мастер-классов и семинаров</option>
				<option>Посещение внешних мастер-классов и тренингов</option>
				<option>Посещение конференций/ бизнес-встреч</option>
				<option>Я не знал(а) о возможности посещения обучающих мероприятий</option>
				<option>Мне отказывали в возможности посещения обучающих мероприятий</option>
			</select>
		</div>
		<div class="form-group">
			<label for="question_9">Будете ли Вы в дальнейшем рассматривать предложение по работе от компании Eldorado?</label>
			<select class="form-control" id="question_9">
				<option>Да, с радостью</option>
				<option>Возможно, в зависимости от предлагаемой вакансии</option>
				<option>Нет, не буду</option>
			</select>
		</div>
		<div class="form-group">
			<label for="question_10">Будете ли Вы рекомендовать компанию Eldorado, как работодателя своим друзьям/ знакомым?</label>
			<select class="form-control" id="question_10">
				<option>Да, с радостью</option>
				<option>Возможно, не уверен(а)</option>
				<option>Нет, не буду</option>
			</select>
		</div>
		<button class="btn btn-default checkBeforeSave" type="button">Сохранить</button>
	</form>
</div>
<%
	var _curUserId = curUser.id;
	// var _curUserId = 6353767353164518050;
	var form = ArrayOptFirstElem(XQuery("for $elem in cc_exitinterview_collabs where $elem/collab_id="+_curUserId+" and $elem/is_done=false() return $elem"));
	if(form==undefined){
		%>
			<script>$('.fillForm').html('Для вас нет анкеты при увольнении.');</script>
		<%
	} else {
		var form_id = String('id_' + form.id);
		%>
			<script>var formID = "<%='id_' + form.id%>";</script>
		<%
	}
	// var formDoc = OpenDoc(UrlFromDocID(form.id));
%>
<script>
	// получаем значение выбранных чекбоксов и формируем строку для отправки на сервер
	function getChecked(id){
			var answers = '';
			$("input[class='"+id+"']:checked").each(function(){
				if($(this).attr('name') != 'self'){
					answers+=($(this).next().text()) + ';';
				} else {
					answers+=($('#self_'+id).val());
				}
			});
			return answers;
		}
	$(document).ready(function(e){
		$('.checkBeforeSave').click(function(){
			var quest_1 = $('#question_1 :selected').html();
			var quest_2 = getChecked('question_2');
			var quest_3 = getChecked('question_3');
			var quest_4 = getChecked('question_4');
			var quest_5 = $('#question_5 :selected').html();
			var quest_6 = $('#question_6 :selected').html();
			var quest_7 = $('#question_7 :selected').html();
			var quest_8 = $('#question_8 :selected').html();
			var quest_9 = $('#question_9 :selected').html();
			var quest_10 = $('#question_10 :selected').html();
			$.ajax({
				type:"POST",
				url: "custom_web_template.html?object_id=6451895140345654518",
				data: 'form=' + formID + '&quest_1=' + quest_1 + '&quest_2=' + quest_2 + '&quest_3=' + quest_3 + '&quest_4=' + quest_4 +
				'&quest_5=' + quest_5 + '&quest_6=' + quest_6 + '&quest_7=' + quest_7 + '&quest_8=' + quest_8 + '&quest_9=' + quest_9 + 
				'&quest_10=' + quest_10,
				error: function(err) { alert("error ajax: "+err); },
				success: function(resp)
				{
					if(resp == 'Success'){
						$('checkbox, select, button').each(function(){
							$(this).prop('disabled', true);
						});
						window.scroll(0,0);
						$('.notification').append('<div class="alert alert-success alert-dismissible fade in"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button><p class="messageText"></p></div>');
						$('.notification').show();
						$('.messageText').html('Анкета успешно сохранена');
						setTimeout(location.reload(), 3000);
					}
				}
			});
		});

		// для проверки на количество выбранных ответов в чекбоксах
		$(':checkbox').change(function(e){
			var checkClass = $(this).attr('class');
			var count = 0;
			$("input[class='"+checkClass+"']:checked").each(function(){
				count++;
			});
			if(count>3){
				$('div > form > button').attr('disabled', true);
			} else {
				$('div > form > button').attr('disabled', false);
			}
			if($(this).attr('name') == "self"){
				var statusTrue = $(this).data('status') == "1";
				var field = $('input#self_'+checkClass);
				if(statusTrue){
					field.hide();
					$(this).data('status', '0');
				} else {
					field.show();
					$(this).data('status', '1');
				}
			} 
		});
	});
</script>